<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Recovered Floppy - A:\\</title>
<style>
  body { background:black; color:#33ff33; font-family:"Courier New", monospace; padding:20px; }
  #terminal { white-space:pre-wrap; line-height:1.4em; }
  input { background:black; border:none; color:#33ff33; font-family:"Courier New", monospace; font-size:16px; width:90%; outline:none; }
  .board { margin-top:30px; border-top:1px solid #33ff33; padding-top:15px; }
</style>
</head>
<body>
<div id="terminal"></div>
<div>> <input id="cmd" autofocus /></div>
<div class="board" id="leaderboard"></div>

<script>
const term = document.getElementById("terminal");
const input = document.getElementById("cmd");
const board = document.getElementById("leaderboard");

function print(text=""){ term.innerHTML += text + "\n"; window.scrollTo(0,document.body.scrollHeight); }

// ===== EDIT THIS BEFORE DEF CON =====
const FINAL_PHRASE = "hackers";  // answer players must reconstruct
const prizeLocation = "[EDIT BEFORE DEF CON — example: Large plant near escalator]";

// ===== LEADERBOARD =====
function loadBoard(){
  const data = JSON.parse(localStorage.getItem("floppy_leaders")||"[]");
  board.innerHTML = "<b>FLOPPY DISK RECOVERY LEADERBOARD</b><br>";
  if(data.length===0){ board.innerHTML += "No recoveries yet.<br>"; return; }
  data.forEach((e,i)=>{
    board.innerHTML += `${i+1}. ${e.name} — ${e.time}<br>`;
  });
}
function addLeader(name){
  const data = JSON.parse(localStorage.getItem("floppy_leaders")||"[]");
  const time = new Date().toLocaleString();
  data.push({name,time});
  localStorage.setItem("floppy_leaders", JSON.stringify(data));
  loadBoard();
}
loadBoard();

// ===== BOOT =====
print("Microsoft Floppy Disk Recovery Utility v3.1");
print("Copyright (C) 1997 DiskCorp");
print("");
print("Scanning disk...");
print("Recovered: README.TXT");
print("Recovered: MAP.DAT");
print("Recovered: BADSECT.LOG");
print("Warning: Deleted file detected");
print("Use sector order to rebuild deleted file.");
print("");

function showHelp(){
  print("Commands:");
  print("DIR");
  print("README.TXT");
  print("MAP.DAT");
  print("BADSECT.LOG");
  print("REBUILD <word>");
  print("CLS");
}

input.addEventListener("keydown", e=>{
  if(e.key==="Enter"){
    const raw=input.value.trim();
    const cmd=raw.toUpperCase();
    print("> "+raw);
    handle(raw,cmd);
    input.value="";
  }
});

function handle(raw,cmd){
  if(cmd==="DIR"){
    print("README.TXT");
    print("BADSECT.LOG");
    print("MAP.DAT");
    print("PRIZE.BIN <deleted>");
  }
  else if(cmd==="HELP") showHelp();
  else if(cmd==="CLS") term.innerHTML="";

  else if(cmd==="README.TXT"){
    print("Recovered conference floppy.");
    print("Deleted file can be rebuilt using bad sector order.");
    print("Reconstruct the hidden word then run:");
    print("REBUILD <word>");
  }

  else if(cmd==="BADSECT.LOG"){
    print("Unreadable sectors (recovery order):");
    print("5");print("3");print("1");print("6");print("4");print("2");print("7");
  }

  else if(cmd==="MAP.DAT"){
    print("[1] c");
    print("[2] r");
    print("[3] a");
    print("[4] e");
    print("[5] h");
    print("[6] k");
    print("[7] s");
  }

  else if(cmd.startsWith("REBUILD")){
    const parts = raw.split(" ");
    if(parts.length<2){ print("Usage: REBUILD <word>"); return; }
    const attempt = parts[1].toLowerCase();

    if(attempt===FINAL_PHRASE){
      success();
    } else {
      print("Rebuild failed. Word does not match recovered sectors.");
    }
  }

  else{
    print("Bad command or file name");
  }
}

function success(){
  print("Rebuilding deleted file...");
  setTimeout(()=>{
    print("Recovery successful.");
    print("");
    print("==== DISK RESTORED ====");
    print("Nice work, hacker.");
    print("Prize location:");
    print(prizeLocation);
    print("");
    let name = prompt("Enter hacker handle for leaderboard:");
    if(name && name.length>0){ addLeader(name); }
    print("Leaderboard updated.");
    print("=======================");
  },1000);
}

showHelp();
</script>
</body>
</html>
